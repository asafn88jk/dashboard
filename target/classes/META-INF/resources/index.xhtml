<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:p="http://primefaces.org/ui"
      lang="he" dir="rtl">
<h:head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>צוות אוטומציה</title>
    <link rel="stylesheet" href="#{request.contextPath}/resources/css/app.css"/>
</h:head>

<h:body styleClass="app">
    <div class="topbar">
        <div class="topbar-inner">

            <div class="topbar-left">
                <!-- empty -->
            </div>

            <div class="topbar-center">
                <h:graphicImage value="#{request.contextPath}/resources/images/empire.png"
                                styleClass="topbar-logo topbar-logo-empire" />
                <div class="brand">צוות אוטומציה</div>
                <h:graphicImage value="#{request.contextPath}/resources/images/empire.png"
                                styleClass="topbar-logo topbar-logo-empire" />
            </div>

            <div class="topbar-right">
                <h:graphicImage value="#{request.contextPath}/resources/images/leumit.png"
                                styleClass="topbar-logo" />
            </div>

        </div>
    </div>


    <div class="shell">
        <aside class="sidebar">
            <div class="sideitem"><i class="pi pi-calendar"></i><span>Planner</span></div>
            <div class="sideitem"><i class="pi pi-check-square"></i><span>Jira</span></div>
            <div class="sideitem"><i class="pi pi-file"></i><span>ALMS</span></div>
            <div class="sideitem"><i class="pi pi-envelope"></i><span>Contact</span></div>
        </aside>

        <main class="main">
            <h:form id="filtersForm">
                <p:poll interval="#{dashboardView.autoRefreshSeconds}"
                        listener="#{dashboardView.refreshCards}"
                        update="cards"
                        process="@this"
                        autoStart="true"
                        rendered="#{dashboardView.autoRefreshEnabled}" />
                <div class="filters">
                    <ui:repeat value="#{dashboardView.filters}" var="f">
                        <p:commandLink styleClass="pill #{dashboardView.activeFilter eq f ? 'active' : ''}"
                                       update="filtersForm cards"
                                       process="@this">
                            <f:setPropertyActionListener target="#{dashboardView.activeFilter}" value="#{f}"/>
                            <h:outputText value="#{f}"/>
                        </p:commandLink>
                    </ui:repeat>
                </div>
            </h:form>

            <h:panelGroup id="cards" layout="block" styleClass="cards">
                <ui:repeat value="#{dashboardView.cards}" var="card">
                    <section class="card">

                        <h:link outcome="details" styleClass="card-title-link">
                            <!-- params MUST be inside h:link -->
                            <f:param name="filter" value="#{card.filterName}" />
                            <f:param name="item"   value="#{card.itemTitle}" />
                            <f:param name="run"    value="#{card.runFolder}" />

                            <!-- clickable content -->
                            <div class="card-title">#{card.title}</div>
                        </h:link>

                        <div class="gauge">
                            <p:chart value="#{card.doughnutJson}" styleClass="donut" />
                            <div class="gauge-center">#{card.passPct}%</div>
                        </div>

                        <div class="card-meta">
                            <div class="meta-line">משך ריצה #{card.duration}</div>
                            <div class="meta-line">
                                <h:outputText value="#{card.startedAt}">
                                    <f:convertDateTime type="localDateTime" pattern="HH:mm dd.MM.yyyy"/>
                                </h:outputText>
                            </div>
                        </div>

                    </section>
                </ui:repeat>
            </h:panelGroup>

        </main>
    </div>
</h:body>
</html>
